# テンセント ASR 非同期 Python 拡張

テンセントクラウド自動音声認識（ASR）サービスのためのPython拡張で、リアルタイム音声テキスト変換機能を提供し、完全な非同期アーキテクチャをサポートします。

## 機能

- **完全非同期サポート**: 完全な非同期アーキテクチャで構築され、高性能音声認識を提供
- **リアルタイムストリーミング**: 低遅延のリアルタイム音声ストリーミングをサポート
- **複数の終了モード**: 設定可能な終了戦略（切断、ミュートパッケージ、ベンダー定義）
- **音声ダンプ**: デバッグと分析のためのオプション音声録音
- **キープアライブサポート**: 設定可能な接続キープアライブメカニズム
- **エラーハンドリング**: 包括的なエラーハンドリングと詳細なログ記録
- **多言語サポート**: 複数の言語とロケールをサポート
- **設定可能なログ**: デバッグ用の調整可能なログレベル

## 設定

拡張には以下の設定パラメータが必要です：

### 必須パラメータ

- `app_id`: テンセントクラウドASRアプリケーションID
- `secret_key`: テンセントクラウドASRシークレットキー
- `params`: ASRリクエストパラメータ（言語、音声形式など）

### オプションパラメータ

- `finalize_mode`: 終了戦略
  - `disconnect`: 終了後に切断
  - `mute_pkg`: ミュートパッケージを送信
  - `vendor_defined`: ベンダー定義戦略を使用（デフォルト）
- `mute_pkg_duration_ms`: ミュートパッケージの持続時間（デフォルト：800ミリ秒）
- `dump`: 音声ダンプを有効化（デフォルト：false）
- `dump_path`: ダンプ音声ファイルのパス
- `keep_alive_interval`: キープアライブ間隔（秒）
- `log_level`: ログレベル（デフォルト："INFO"）

### 設定例

```json
{
  "app_id": "your_app_id",
  "secret_key": "your_secret_key",
  "params": {
    "language": "ja-JP",
    "format": "pcm",
    "sample_rate": 16000
  },
  "finalize_mode": "vendor_defined",
  "dump": false,
  "log_level": "INFO"
}
```

## API

拡張は `AsyncASRBaseExtension` インターフェースを実装し、以下の主要メソッドを提供します：

### コアメソッド

- `on_init()`: ASRクライアントと設定を初期化
- `start_connection()`: テンセントASRサービスへの接続を確立
- `stop_connection()`: ASRサービス接続を閉じる
- `send_audio()`: 認識用の音声フレームを送信
- `finalize()`: 現在の認識セッションを終了

### イベントハンドラー

- `on_asr_start()`: ASRセッション開始時に呼び出し
- `on_asr_sentence_start()`: 新しい文が開始時に呼び出し
- `on_asr_sentence_change()`: 文の内容が変更時に呼び出し
- `on_asr_sentence_end()`: 文が終了時に呼び出し
- `on_asr_complete()`: ASRセッション完了時に呼び出し
- `on_asr_fail()`: ASRが失敗時に呼び出し
- `on_asr_error()`: ASRがエラーに遭遇時に呼び出し

## 依存関係

- `typing_extensions`: 型ヒント用
- `pydantic`: 設定検証用
- `websockets`: WebSocket通信用
- `pytest`: テスト用（開発依存関係）

## 開発

### ビルド

拡張はTEN Frameworkビルドシステムの一部としてビルドされ、追加のビルド手順は不要です。

### 単体テスト

以下のコマンドで単体テストを実行：

```bash
pytest tests/
```

拡張には以下の包括的なテストが含まれています：
- 設定検証
- 音声処理
- エラーハンドリング
- 接続管理

## 使用方法

1. **インストール**: 拡張はTEN Frameworkと共に自動インストールされます
2. **設定**: テンセントクラウドASR認証情報とパラメータを設定
3. **統合**: TEN Framework ASRインターフェースを通じて拡張を使用
4. **監視**: デバッグと監視のためにログを確認

## エラーハンドリング

拡張は以下の方法で詳細なエラー情報を提供します：
- モジュールエラーコード
- ベンダー固有のエラー詳細
- 包括的なログ記録
- 優雅な劣化

## パフォーマンス

- **低遅延**: リアルタイム処理に最適化
- **高スループット**: 効率的な音声フレーム処理
- **メモリ効率**: 最小のメモリ使用量
- **接続再利用**: 可能な限り永続接続を維持

## セキュリティ

- **認証情報暗号化**: 機密認証情報は設定で暗号化
- **安全な通信**: 安全なWebSocket接続を使用
- **入力検証**: 包括的な入力検証とサニタイゼーション

## トラブルシューティング

### 一般的な問題

1. **接続失敗**: app_idとsecret_key設定を確認
2. **音声品質問題**: 音声形式とサンプルレート設定を確認
3. **パフォーマンス問題**: バッファ設定と終了モードを調整
4. **ログ問題**: 適切なログレベルを設定

### デバッグモード

設定で `dump: true` を設定してデバッグモードを有効化し、分析用に音声を録音します。

## ライセンス

この拡張はTEN Frameworkの一部で、Apache License, Version 2.0の下でライセンスされています。
